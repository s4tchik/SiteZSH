<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Статистика — ZSH</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0; padding: 0; min-height: 100%;
      font-family: 'Orbitron', sans-serif;
      background: #0a0a0a;
      color: #eee;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(10,10,10,0.85);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 15px #7f5af0bb;
      z-index: 10;
      user-select: none;
    }
    header div strong {
      color: #7f5af0;
      font-size: 1.6rem;
      text-shadow: 0 0 20px #7f5af0;
    }
    nav a {
      color: #eee;
      margin-left: 1.4rem;
      text-decoration: none;
      font-weight: 600;
      position: relative;
      transition: color 0.3s ease;
      user-select: none;
    }
    nav a:first-child {
      margin-left: 0;
    }
    nav a:hover,
    nav a:focus {
      color: #7f5af0;
      outline: none;
    }
    nav a:hover::after {
      content: '';
      position: absolute;
      left: 0; bottom: -4px;
      width: 100%;
      height: 2px;
      background: #7f5af0;
      border-radius: 2px;
    }
    main {
      max-width: 1000px;
      margin: 100px auto 60px;
      padding: 0 1rem;
      flex-grow: 1;
      user-select: none;
    }
    section {
      background: #121212;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 0 15px #7f5af0bb;
      user-select: none;
    }
    h1, h2 {
      color: #00aaff;
      margin-bottom: 15px;
      user-select: none;
    }
    h2 {
      border-bottom: 2px solid #00aaff;
      padding-bottom: 6px;
    }
    canvas {
      max-width: 100%;
      height: 300px;
      margin-top: 15px;
      user-select: none;
      border-radius: 12px;
      background: #0a0a0a;
      box-shadow: inset 0 0 10px #7f5af0aa;
    }
    .export-btn {
      display: block;
      margin: 15px auto 0;
      padding: 12px 25px;
      background-color: #7f5af0;
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s, box-shadow 0.3s;
      user-select: none;
      box-shadow: 0 0 15px #7f5af0cc;
    }
    .export-btn:hover {
      background-color: #a37aff;
      box-shadow: 0 0 25px #a37affdd;
    }
    .compare-toggle {
      margin-bottom: 15px;
      text-align: center;
      user-select: none;
    }
    .compare-toggle label {
      cursor: pointer;
      font-weight: 600;
      color: #aad8ff;
      user-select: none;
    }
    .compare-toggle input[type="checkbox"] {
      margin-left: 8px;
      transform: scale(1.3);
      vertical-align: middle;
      cursor: pointer;
      accent-color: #7f5af0;
      user-select: none;
      transition: accent-color 0.3s;
    }
    .compare-toggle input[type="checkbox"]:hover {
      accent-color: #a37aff;
    }
  </style>
</head>
<body>
  <header>
    <div><strong>ZSH</strong></div>
    <nav>
      <a href="index.html">Главная</a>
      <a href="about.html">О нас</a>
      <a href="games.html">Игры</a>
      <a href="blog.html">Блог</a>
      <a href="login.html">Войти</a>
    </nav>
  </header>

  <main>
    <h1>Статистика и Аналитика — ZSH</h1>

    <section>
      <h2>Время на сайте (последние 7 дней)</h2>
      <canvas id="timeOnSiteChart" role="img" aria-label="График времени на сайте за последние 7 дней"></canvas>
    </section>

    <section>
      <h2>Активность в играх (последние 7 дней)</h2>
      <div class="compare-toggle">
        <label for="toggleFriendsStats">Показать статистику друзей
          <input type="checkbox" id="toggleFriendsStats" />
        </label>
      </div>
      <canvas id="gameActivityChart" role="img" aria-label="График активности в играх за последние 7 дней"></canvas>
    </section>

    <section>
      <h2>Комментарии в блоге и форуме</h2>
      <canvas id="commentsChart" role="img" aria-label="График комментариев за последние 7 дней"></canvas>
    </section>

    <section>
      <h2>Полученные достижения</h2>
      <canvas id="achievementsChart" role="img" aria-label="Диаграмма полученных достижений"></canvas>
    </section>

    <button class="export-btn" id="exportBtn" aria-label="Экспортировать данные в CSV">Экспортировать данные в CSV</button>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Пример данных — в реальности данные должны приходить с сервера
    const userData = {
      timeOnSite: [30, 45, 40, 60, 55, 70, 65], // минуты за 7 дней
      gameActivity: [5, 6, 4, 7, 8, 10, 9],     // игры/сессии
      friendsGameActivity: [3, 4, 5, 6, 7, 5, 8],
      comments: [2, 3, 1, 4, 2, 3, 5],
      achievements: {
        "Новичок": 1,
        "Исследователь": 3,
        "Мастер": 2,
        "Легенда": 0
      }
    };

    // Время по дням для оси X
    const last7DaysLabels = (() => {
      const days = [];
      for(let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        days.push(d.toLocaleDateString('ru-RU', { weekday: 'short', day: 'numeric', month: 'numeric' }));
      }
      return days;
    })();

    // Время на сайте
    const timeOnSiteCtx = document.getElementById('timeOnSiteChart').getContext('2d');
    const timeOnSiteChart = new Chart(timeOnSiteCtx, {
      type: 'line',
      data: {
        labels: last7DaysLabels,
        datasets: [{
          label: 'Время на сайте (мин)',
          data: userData.timeOnSite,
          borderColor: '#00aaff',
          backgroundColor: 'rgba(0,170,255,0.2)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 7
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        }
      }
    });

    // Активность в играх
    const gameActivityCtx = document.getElementById('gameActivityChart').getContext('2d');
    let gameActivityChart = null;
    function renderGameActivityChart(showFriends = false) {
      if(gameActivityChart) {
        gameActivityChart.destroy();
      }
      const datasets = [{
        label: 'Ваша активность',
        data: userData.gameActivity,
        borderColor: '#00ff99',
        backgroundColor: 'rgba(0,255,153,0.3)',
        fill: true,
        tension: 0.3,
        pointRadius: 5,
        pointHoverRadius: 7
      }];
      if(showFriends) {
        datasets.push({
          label: 'Активность друзей',
          data: userData.friendsGameActivity,
          borderColor: '#ff9933',
          backgroundColor: 'rgba(255,153,51,0.3)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 7
        });
      }
      gameActivityChart = new Chart(gameActivityCtx, {
        type: 'line',
        data: {
          labels: last7DaysLabels,
          datasets: datasets
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              max: 15
            }
          }
        }
      });
    }
    renderGameActivityChart(false);

    document.getElementById('toggleFriendsStats').addEventListener('change', e => {
      renderGameActivityChart(e.target.checked);
    });

    // Комментарии
    const commentsCtx = document.getElementById('commentsChart').getContext('2d');
    const commentsChart = new Chart(commentsCtx, {
      type: 'bar',
      data: {
        labels: last7DaysLabels,
        datasets: [{
          label: 'Комментарии',
          data: userData.comments,
          backgroundColor: '#0078d7'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            max: 10
          }
        }
      }
    });

    // Достижения (круговая диаграмма)
    const achievementsCtx = document.getElementById('achievementsChart').getContext('2d');
    const achievementLabels = Object.keys(userData.achievements);
    const achievementData = Object.values(userData.achievements);
    const achievementsChart = new Chart(achievementsCtx, {
      type: 'doughnut',
      data: {
        labels: achievementLabels,
        datasets: [{
          label: 'Достижения',
          data: achievementData,
          backgroundColor: [
            '#00aaff',
            '#00ff99',
            '#ffcc00',
            '#ff3300'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });

    // Экспорт данных в CSV
    document.getElementById('exportBtn').addEventListener('click', () => {
      let csv = 'Дата;Время на сайте (мин);Активность в играх;Активность друзей;Комментарии\n';
      for(let i = 0; i < last7DaysLabels.length; i++) {
        csv += `${last7DaysLabels[i]};${userData.timeOnSite[i]};${userData.gameActivity[i]};${userData.friendsGameActivity[i]};${userData.comments[i]}\n`;
      }
      // Добавим достижения
      csv += '\nДостижения:\nНазвание;Количество\n';
      achievementLabels.forEach((label, idx) => {
        csv += `${label};${achievementData[idx]}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'zsh_stats.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
