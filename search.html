<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Поиск по сайту — ZSH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet" />
  <style>
    /* Reset */
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Orbitron', sans-serif;
      background: #0a0a0a;
      color: #eee;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      background: rgba(10,10,10,0.85);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 15px #7f5af0bb;
      z-index: 10;
      user-select: none;
    }
    header div strong {
      color: #7f5af0;
      font-size: 1.6rem;
      text-shadow: 0 0 20px #7f5af0;
    }
    nav a {
      color: #eee;
      margin-left: 1.4rem;
      text-decoration: none;
      font-weight: 600;
      position: relative;
      transition: color 0.3s ease;
      user-select: none;
    }
    nav a:first-child {
      margin-left: 0;
    }
    nav a:hover,
    nav a:focus {
      color: #7f5af0;
      outline: none;
    }
    nav a:hover::after {
      content: '';
      position: absolute;
      left: 0; bottom: -4px;
      width: 100%;
      height: 2px;
      background: #7f5af0;
      border-radius: 2px;
    }

    main {
      max-width: 960px;
      margin: 110px auto 60px;
      padding: 0 1rem;
      flex-grow: 1;
      user-select: none;
    }

    .search-form {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
      align-items: center;
    }
    .search-container {
      position: relative;
      flex-grow: 1;
      min-width: 280px;
    }
    input[type="search"] {
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: #222;
      color: #eee;
      font-size: 1.15rem;
      outline-offset: 2px;
      outline-color: transparent;
      transition: outline-color 0.3s;
      user-select: text;
    }
    input[type="search"]:focus {
      outline-color: #7f5af0;
      background: #2a2a2a;
    }

    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #222;
      border: 1px solid #7f5af0;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 0 0 12px 12px;
      z-index: 20;
      user-select: none;
    }
    .autocomplete-item {
      padding: 10px 14px;
      cursor: pointer;
      color: #ccc;
      transition: background-color 0.3s, color 0.3s;
    }
    .autocomplete-item:hover,
    .autocomplete-item.active {
      background: #7f5af0;
      color: #fff;
      outline: none;
    }

    fieldset {
      border: 1.8px solid #7f5af0;
      border-radius: 12px;
      padding: 14px 18px;
      min-width: 220px;
      color: #7f5af0;
      user-select: none;
    }
    legend {
      font-weight: 700;
      padding: 0 8px;
      font-size: 1.1rem;
    }
    label {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #a0d8ff;
      user-select: none;
    }
    label input[type="checkbox"],
    label input[type="radio"] {
      margin-right: 8px;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    select {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1.8px solid #7f5af0;
      background: #222;
      color: #eee;
      font-size: 1.1rem;
      cursor: pointer;
      margin-left: auto;
      user-select: none;
      min-width: 160px;
      transition: border-color 0.3s;
    }
    select:focus {
      border-color: #a37aff;
      outline: none;
      background: #2a2a2a;
    }

    button[type="submit"] {
      padding: 14px 30px;
      background: #7f5af0;
      border: none;
      border-radius: 14px;
      font-weight: 700;
      color: #0a0a0a;
      font-size: 1.15rem;
      cursor: pointer;
      flex-shrink: 0;
      transition: background-color 0.3s, box-shadow 0.3s;
      user-select: none;
      box-shadow: 0 0 18px #7f5af0cc;
    }
    button[type="submit"]:hover,
    button[type="submit"]:focus {
      background: #a37aff;
      outline: none;
      box-shadow: 0 0 30px #a37affdd;
    }

    .results-info {
      margin-bottom: 14px;
      font-weight: 600;
      color: #7f5af0;
      user-select: none;
    }
    .results-list {
      list-style: none;
      padding-left: 0;
      user-select: none;
    }
    .result-item {
      background: #222;
      padding: 18px 20px;
      margin-bottom: 18px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(127,90,240,0.4);
      cursor: pointer;
      transition: background-color 0.3s, box-shadow 0.3s;
      outline-offset: 2px;
      outline-color: transparent;
    }
    .result-item:hover,
    .result-item:focus {
      background: #7f5af0;
      box-shadow: 0 0 25px #a37affdd;
      color: white;
      outline: none;
    }
    .result-title {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 6px;
      color: #00d8ff;
      user-select: text;
    }
    .result-snippet {
      color: #ccc;
      margin-bottom: 10px;
      user-select: text;
    }
    .result-meta {
      font-size: 0.95rem;
      color: #88cfff;
      user-select: text;
    }

    mark {
      background-color: #a37aff88;
      color: inherit;
      font-weight: 700;
      user-select: text;
    }

    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 28px;
      gap: 10px;
      user-select: none;
    }
    .pagination button {
      padding: 9px 16px;
      background: #7f5af0;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.05rem;
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    .pagination button:disabled {
      background: #444;
      cursor: default;
      box-shadow: none;
    }
    .pagination button:hover:not(:disabled),
    .pagination button:focus:not(:disabled) {
      background: #a37aff;
      outline: none;
      box-shadow: 0 0 20px #a37affdd;
    }

    /* Адаптив */
    @media (max-width: 520px) {
      fieldset {
        min-width: 100%;
      }
      select {
        min-width: 100%;
        margin-left: 0;
      }
      .search-form {
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div><strong>ZSH</strong></div>
    <nav>
      <a href="index.html">Главная</a>
      <a href="about.html">О нас</a>
      <a href="games.html">Игры</a>
      <a href="blog.html">Блог</a>
      <a href="login.html">Войти</a>
    </nav>
  </header>

  <main role="main" aria-labelledby="pageTitle">
    <h1 id="pageTitle" style="color:#7f5af0; user-select:none; margin-bottom: 1.8rem;">Поиск по сайту — ZSH</h1>

    <form class="search-form" id="searchForm" autocomplete="off" role="search" aria-label="Поиск по сайту">
      <div class="search-container">
        <input
          type="search"
          id="searchInput"
          name="search"
          placeholder="Введите запрос..."
          aria-autocomplete="list"
          aria-controls="autocompleteList"
          aria-expanded="false"
          aria-haspopup="listbox"
          aria-activedescendant=""
          role="combobox"
          autocomplete="off"
        />
        <div
          class="autocomplete-list"
          id="autocompleteList"
          role="listbox"
          aria-label="Рекомендуемые запросы"
          hidden
        ></div>
      </div>

      <fieldset>
        <legend>Фильтры по типу</legend>
        <label><input type="checkbox" name="type" value="blog" checked /> Блог</label>
        <label><input type="checkbox" name="type" value="games" checked /> Игры</label>
        <label><input type="checkbox" name="type" value="forum" checked /> Форум</label>
        <label><input type="checkbox" name="type" value="resources" checked /> Ресурсы</label>
      </fieldset>

      <label for="sortSelect" style="align-self:center; color:#7f5af0; font-weight:700; margin-left:auto; user-select:none;">
        Сортировка:
      </label>
      <select id="sortSelect" name="sort" aria-label="Сортировка результатов">
        <option value="date">По дате</option>
        <option value="relevance" selected>По релевантности</option>
      </select>

      <button type="submit" aria-label="Искать по сайту">Искать</button>
    </form>

    <div class="results-info" id="resultsInfo" aria-live="polite" aria-atomic="true"></div>
    <ul class="results-list" id="resultsList"></ul>
    <div class="pagination" id="pagination"></div>
  </main>

  <script>
    const searchData = [
      { id: 1, type: "blog", title: "Обзор новой игры ZSH", date: "2025-06-10", content: "В этом обзоре мы подробно рассмотрим новую игру от ZSH с уникальным геймплеем и графикой.", url: "#blog1" },
      { id: 2, type: "games", title: "ZSH: Руководство для новичков", date: "2025-06-05", content: "Начните играть в ZSH с нашего подробного руководства, которое поможет освоиться быстро и эффективно.", url: "#game1" },
      { id: 3, type: "forum", title: "Вопрос по механике боя", date: "2025-06-18", content: "Кто-то спросил о тонкостях боя в ZSH. Обсуждаем стратегии и тактики в бою.", url: "#forum1" },
      { id: 4, type: "resources", title: "Скачать текстуры для ZSH", date: "2025-06-12", content: "Здесь вы можете скачать набор текстур для моддинга в игре ZSH.", url: "#resources1" },
      { id: 5, type: "blog", title: "Новости команды ZSH", date: "2025-06-20", content: "Последние новости и события в команде ZSH, планы на будущее и релизы.", url: "#blog2" },
      { id: 6, type: "forum", title: "Где найти союзников?", date: "2025-06-19", content: "Обсуждаем способы поиска друзей и союзников в сообществе ZSH.", url: "#forum2" },
      { id: 7, type: "games", title: "Обновление патча 1.2", date: "2025-06-15", content: "В этом обновлении патча мы исправили баги и добавили новый контент.", url: "#game2" }
    ];

    const RESULTS_PER_PAGE = 3;
    let currentPage = 1;
    let filteredResults = [];

    const searchInput = document.getElementById('searchInput');
    const autocompleteList = document.getElementById('autocompleteList');
    const resultsInfo = document.getElementById('resultsInfo');
    const resultsList = document.getElementById('resultsList');
    const pagination = document.getElementById('pagination');
    const searchForm = document.getElementById('searchForm');
    const sortSelect = document.getElementById('sortSelect');

    function highlightMatch(text, query) {
      if(!query) return text;
      const re = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(re, '<mark>$1</mark>');
    }

    function updateAutocomplete() {
      const query = searchInput.value.trim().toLowerCase();
      if(query.length < 2) {
        autocompleteList.hidden = true;
        searchInput.setAttribute('aria-expanded', 'false');
        return;
      }
      const suggestions = searchData.filter(item =>
        item.title.toLowerCase().includes(query) || item.content.toLowerCase().includes(query)
      ).slice(0, 5);

      if(suggestions.length === 0){
        autocompleteList.hidden = true;
        searchInput.setAttribute('aria-expanded', 'false');
        return;
      }

      autocompleteList.innerHTML = suggestions.map(item =>
        `<div class="autocomplete-item" role="option" data-id="${item.id}" tabindex="-1" id="auto-item-${item.id}">${item.title}</div>`
      ).join('');
      autocompleteList.hidden = false;
      searchInput.setAttribute('aria-expanded', 'true');
    }

    autocompleteList.addEventListener('click', e => {
      if(e.target.classList.contains('autocomplete-item')){
        const id = +e.target.dataset.id;
        const item = searchData.find(x => x.id === id);
        if(item){
          searchInput.value = item.title;
          autocompleteList.hidden = true;
          searchInput.setAttribute('aria-expanded', 'false');
          performSearch();
        }
      }
    });

    let autocompleteIndex = -1;
    searchInput.addEventListener('keydown', e => {
      const items = autocompleteList.querySelectorAll('.autocomplete-item');
      if(autocompleteList.hidden || items.length === 0) return;

      if(e.key === 'ArrowDown') {
        e.preventDefault();
        autocompleteIndex = (autocompleteIndex + 1) % items.length;
        items.forEach(i => i.classList.remove('active'));
        items[autocompleteIndex].classList.add('active');
        searchInput.setAttribute('aria-activedescendant', items[autocompleteIndex].id);
      } else if(e.key === 'ArrowUp') {
        e.preventDefault();
        autocompleteIndex = (autocompleteIndex - 1 + items.length) % items.length;
        items.forEach(i => i.classList.remove('active'));
        items[autocompleteIndex].classList.add('active');
        searchInput.setAttribute('aria-activedescendant', items[autocompleteIndex].id);
      } else if(e.key === 'Enter') {
        if(autocompleteIndex >= 0 && items[autocompleteIndex]){
          e.preventDefault();
          items[autocompleteIndex].click();
          autocompleteIndex = -1;
          searchInput.setAttribute('aria-activedescendant', '');
        }
      } else {
        autocompleteIndex = -1;
        searchInput.setAttribute('aria-activedescendant', '');
        setTimeout(updateAutocomplete, 0);
      }
    });

    function performSearch(page = 1) {
      const query = searchInput.value.trim().toLowerCase();
      if(!query){
        resultsInfo.textContent = 'Введите запрос для поиска.';
        resultsList.innerHTML = '';
        pagination.innerHTML = '';
        return;
      }

      const checkedTypes = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(i => i.value);

      filteredResults = searchData.filter(item =>
        checkedTypes.includes(item.type) &&
        (item.title.toLowerCase().includes(query) || item.content.toLowerCase().includes(query))
      );

      // Сортировка
      if(sortSelect.value === 'date') {
        filteredResults.sort((a,b) => new Date(b.date) - new Date(a.date));
      } else {
        // По релевантности — количество вхождений
        filteredResults.sort((a,b) => {
          const countA = (a.title.toLowerCase().match(new RegExp(query, 'g')) || []).length +
                         (a.content.toLowerCase().match(new RegExp(query, 'g')) || []).length;
          const countB = (b.title.toLowerCase().match(new RegExp(query, 'g')) || []).length +
                         (b.content.toLowerCase().match(new RegExp(query, 'g')) || []).length;
          return countB - countA;
        });
      }

      currentPage = page;
      renderResultsPage();
    }

    function renderResultsPage(){
      const start = (currentPage -1)*RESULTS_PER_PAGE;
      const end = start + RESULTS_PER_PAGE;
      const pageResults = filteredResults.slice(start, end);

      resultsList.innerHTML = pageResults.length === 0 ? '<li>Ничего не найдено.</li>' :
        pageResults.map(item => `
          <li class="result-item" tabindex="0" role="article" aria-label="${item.type} - ${item.title}">
            <a href="${item.url}" style="color: inherit; text-decoration:none;">
              <div class="result-title">${highlightMatch(item.title, searchInput.value.trim())}</div>
              <div class="result-snippet">${highlightMatch(item.content, searchInput.value.trim())}</div>
              <div class="result-meta">${item.type.toUpperCase()} — ${new Date(item.date).toLocaleDateString('ru-RU')}</div>
            </a>
          </li>
        `).join('');

      const totalPages = Math.ceil(filteredResults.length / RESULTS_PER_PAGE);

      resultsInfo.textContent = `Найдено результатов: ${filteredResults.length}. Страница ${currentPage} из ${totalPages}`;

      pagination.innerHTML = '';
      if(totalPages > 1){
        if(currentPage > 1){
          const prevBtn = document.createElement('button');
          prevBtn.textContent = '← Назад';
          prevBtn.onclick = () => performSearch(currentPage - 1);
          pagination.appendChild(prevBtn);
        }
        if(currentPage < totalPages){
          const nextBtn = document.createElement('button');
          nextBtn.textContent = 'Вперед →';
          nextBtn.onclick = () => performSearch(currentPage + 1);
          pagination.appendChild(nextBtn);
        }
      }
    }

    document.getElementById('searchForm').addEventListener('submit', e => {
      e.preventDefault();
      performSearch(1);
      autocompleteList.hidden = true;
      searchInput.setAttribute('aria-expanded', 'false');
    });

    // Инициализация автокомплита при загрузке
    searchInput.addEventListener('input', updateAutocomplete);
  </script>
</body>
</html>
